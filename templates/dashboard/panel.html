{% extends 'base.html' %}
{% block content %}

<h2 style="color: #EB51A2;">Panel de Administraci√≥n</h2>
<p>Bienvenida al dashboard, {{ current_user.username }}!</p>

<!-- Crear Categor√≠a -->
<div style="border: 2px solid #4DCFCF; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
    <h3 style="color: #4DCFCF;">Crear Nueva Categor√≠a</h3>
    <form method="POST" action="{{ url_for('crear_categoria') }}" enctype="multipart/form-data">
        <input type="text" name="name" placeholder="Nombre de la categor√≠a" required 
               style="padding: 8px; width: 300px; margin: 5px;"><br>
        <textarea name="description" placeholder="Descripci√≥n (opcional)" 
                  style="padding: 8px; width: 300px; margin: 5px; height: 60px;"></textarea><br>
        <input type="file" name="cover_image" accept="image/*" style="margin: 5px;">
        <small>Imagen de portada (opcional)</small><br>
        <button type="submit" style="background: #EB51A2; color: white; padding: 8px 15px; border: none; border-radius: 5px;">
            Crear Categor√≠a
        </button>
    </form>
</div>

<!-- Lista de Categor√≠as -->
<div style="border: 2px solid #4DCFCF; padding: 20px; border-radius: 10px;">
    <h3 style="color: #4DCFCF;">Tus Categor√≠as</h3>
    
    {% for category in categories %}
    <div style="border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 5px;">
        <!-- ENCABEZADO CON BOTONES DE ACCI√ìN -->
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
            <div>
                <h4 style="color: #EB51A2; margin: 0 0 5px 0;">{{ category.name }}</h4>
                {% if category.description %}
                <p style="margin: 0; color: #666;">{{ category.description }}</p>
                {% endif %}
            </div>
            <div style="display: flex; gap: 8px;">
                <a href="{{ url_for('editar_categoria', category_id=category.id) }}" 
                   style="background: #EB51A2; color: white; padding: 6px 12px; border-radius: 5px; text-decoration: none; font-size: 12px; transition: all 0.3s ease;">
                     Editar
                </a>
                <form method="POST" action="{{ url_for('eliminar_categoria', category_id=category.id) }}" 
                      onsubmit="return confirm('¬øEst√°s segura de eliminar la categor√≠a &quot;{{ category.name }}&quot; y sus {{ category.images|length }} im√°genes?')"
                      style="margin: 0;">
                    <button type="submit" 
                            style="background: #ff4444; color: white; border: none; padding: 6px 12px; border-radius: 5px; cursor: pointer; font-size: 12px; transition: all 0.3s ease;">
                        üóëÔ∏è Eliminar
                    </button>
                </form>
            </div>
        </div>
        
        <!-- IMAGEN DE PORTADA -->
        {% if category.cover_image %}
        <img src="{{ url_for('static', filename='uploads/' ~ category.cover_image) }}" 
             style="width: 150px; height: 150px; object-fit: cover; border-radius: 5px; margin-bottom: 10px;">
        {% endif %}
        
        <!-- Subir Imagen a esta categor√≠a -->
        <form method="POST" action="{{ url_for('subir_imagen', category_id=category.id) }}" 
              enctype="multipart/form-data" style="margin: 15px 0;">
            <input type="text" name="title" placeholder="T√≠tulo de la imagen (opcional)" 
                   style="padding: 5px; margin: 5px;">
            <input type="file" name="image" accept="image/*" multiple required style="margin: 5px;">
            <button type="submit" style="background: #4DCFCF; color: white; padding: 5px 10px; border: none; border-radius: 3px;">
                Subir Im√°genes
            </button>
        </form>
        
        <!-- Mostrar Im√°genes de la categor√≠a -->
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            {% for image in category.images %}
            <div style="text-align: center;">
                <img src="{{ url_for('static', filename='uploads/' ~ image.filename) }}" 
                     style="width: 100px; height: 100px; object-fit: cover; border: 2px solid #EB51A2;">
                {% if image.title %}
                <p style="margin: 5px 0; font-size: 12px;">{{ image.title }}</p>
                {% endif %}
                <form method="POST" action="{{ url_for('eliminar_imagen', image_id=image.id) }}" 
                      onsubmit="return confirm('¬øEliminar esta imagen?')">
                    <button type="submit" style="background: red; color: white; border: none; padding: 2px 8px;">
                        Eliminar
                    </button>
                </form>
            </div>
            {% else %}
            <p style="color: #666;">No hay im√°genes en esta categor√≠a</p>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <p style="color: #666;">No hay categor√≠as creadas a√∫n</p>
    {% endfor %}
</div>

<!-- Enlace para volver al sitio p√∫blico -->
<div style="margin-top: 20px;">
    <a href="{{ url_for('public.home') }}" style="color: #4DCFCF;">‚Üê Volver al sitio p√∫blico</a>
</div>


{% endblock %}


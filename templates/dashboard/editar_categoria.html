{% extends 'base.html' %}
{% block content %}

<div class="dashboard-section">
    <h2>Editar Proyecto</h2>
    
    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label for="name">Nombre del proyecto:</label>
            <input type="text" id="name" name="name" value="{{ proyecto.name }}" required>
        </div>
        
        <div class="form-group">
            <label for="description">Descripción:</label>
            <textarea id="description" name="description" rows="4">{{ proyecto.description or '' }}</textarea>
        </div>
        
        <div class="form-group">
            <label for="cover_image">Imagen de portada actual:</label>
            {% if proyecto.cover_image %}
            <div class="current-image">
                <img src="{{ url_for('static', filename='uploads/' ~ proyecto.cover_image) }}" 
                     style="width: 200px; height: 200px; object-fit: cover; border-radius: 10px; display: block; margin: 10px 0;">
                <small>{{ proyecto.cover_image }}</small>
            </div>
            {% else %}
            <p style="color: #666;">No hay imagen de portada</p>
            {% endif %}
            
            <label for="new_cover_image" style="margin-top: 15px; display: block;">Cambiar imagen de portada:</label>
            <input type="file" id="new_cover_image" name="cover_image" accept="image/*">
            <small>Dejar vacío para mantener la imagen actual</small>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-primary">Guardar Cambios</button>
            <a href="{{ url_for('dashboard_panel') }}" class="btn-secondary">Cancelar</a>
        </div>
    </form>
    
    <!-- Estadísticas del proyecto -->
    <div class="category-stats" style="margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 10px;">
        <h4>Estadísticas del Proyecto</h4>
        <p><strong>Total de imágenes:</strong> {{ proyecto.images|length }}</p>
        <p><strong>ID:</strong> {{ proyecto.id }}</p>
    </div>
    
    <!-- Galería de imágenes -->
    {% if proyecto.images %}
    <div style="margin-top: 30px; border: 2px solid #4DCFCF; padding: 20px; border-radius: 10px;">
        <h3 style="color: #4DCFCF;">Galería de Imágenes</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 15px;">
            {% for image in proyecto.images %}
            <div style="text-align: center;">
                <img src="{{ url_for('static', filename='uploads/' ~ image.filename) }}" 
                     style="width: 100px; height: 100px; object-fit: cover; border: 2px solid #EB51A2; border-radius: 5px;">
                {% if image.title %}
                <p style="margin: 5px 0; font-size: 12px;">{{ image.title }}</p>
                {% endif %}
                <form method="POST" action="{{ url_for('eliminar_imagen', image_id=image.id) }}" 
                      onsubmit="return confirm('¿Eliminar esta imagen?')" style="margin-top: 5px;">
                    <button type="submit" style="background: red; color: white; border: none; padding: 2px 8px; border-radius: 3px; cursor: pointer; font-size: 12px;">
                        Eliminar
                    </button>
                </form>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Subir más imágenes -->
    <div style="margin-top: 30px; border: 2px solid #4DCFCF; padding: 20px; border-radius: 10px;">
        <h3 style="color: #4DCFCF;">Agregar más imágenes</h3>
        <form method="POST" action="{{ url_for('subir_imagen', proyecto_id=proyecto.id) }}" enctype="multipart/form-data">
            <input type="text" name="title" placeholder="Título de la imagen (opcional)" 
                   style="padding: 5px; margin: 5px; border: 1px solid #ddd; border-radius: 3px;">
            <input type="file" name="image" accept="image/*" multiple required style="margin: 5px;">
            <button type="submit" style="background: #4DCFCF; color: white; padding: 5px 10px; border: none; border-radius: 3px; cursor: pointer;">
                Subir Imágenes
            </button>
        </form>
    </div>
    
    <!-- Eliminar proyecto (con confirmación) -->
    <div class="danger-zone" style="margin-top: 30px; padding: 20px; background: #ffebee; border: 2px solid #f44336; border-radius: 10px;">
        <p style="color: #666; margin-bottom: 15px;">
            ⚠️ Eliminar este proyecto también eliminará todas las imágenes asociadas. Esta acción no se puede deshacer.
        </p>
        <form method="POST" action="{{ url_for('eliminar_proyecto', proyecto_id=proyecto.id) }}" 
              onsubmit="return confirm('¿Estás segura de que quieres eliminar este proyecto? Se eliminarán {{ proyecto.images|length }} imágenes.')">
            <button type="submit" class="btn-danger">Eliminar Proyecto</button>
        </form>
    </div>
</div>

{% endblock %}
